<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Send Data to API</title>
  </head>
  <body>
    <h1>Enter Basket Item Information</h1>
    <form id="basket-form">
      <label for="basket-name">Basket Name:</label>
      <input type="text" id="basket-name" name="basket-name"><br><br>
      
      <label for="item">Item:</label>
      <input type="text" id="item" name="item"><br><br>
      
      <label for="item-link">Item Link:</label>
      <input type="text" id="item-link" name="item-link"><br><br>
      
      <input type="submit" value="Submit">
    </form>
    
    <form>
      <label for="classificationType">Classification type:</label>
      <select id="classificationType" name="classificationType">
        <option value="hierarchical">Hierarchical</option>
        <option value="non-hierarchical">Non-hierarchical</option>
        <option value="tree">Tree</option>
      </select><br>
      <label for="numLevels">Number of levels:</label>
      <input type="number" id="numLevels" name="numLevels" min="1" max="10" required><br>
      <input type="button" id="submitButton" value="Submit">
    </form>

    <label for="basketSelect">Select a basket:</label>
    <select id="basketSelect"></select>

    <script>
    const form = document.querySelector('#basket-form');
    const firstApiUrl = 'http://100061.pythonanywhere.com/allbaskets/';

form.addEventListener('submit', (event) => {
  event.preventDefault(); 
  const basketName = document.querySelector('#basket-name').value;
  const itemName = document.querySelector('#item').value;
  const itemLink = document.querySelector('#item-link').value;

  const data = {
    basketName: basketName,
    items: [
      {
        itemName: itemName,
        itemLink: itemLink
      }
    ]
  };

  fetch(firstApiUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(data => {
    // handling first API response here

    const secondApiUrl = 'http://100061.pythonanywhere.com/type/';
    const classificationType = document.querySelector('#classificationType').value;
    const numLevels = document.querySelector('#numLevels').value;

    const secondData = {
      dbinsertedId: data.dbinsertedId,
      classificationType,
      numLevels
    };

    fetch(secondApiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(secondData)
    })
    .then(response => response.json())
    .then(data => {
      // handling second API response here

      // Populate dropdown list with available baskets
      const basketSelect = document.querySelector('#basketSelect');

      data.baskets.forEach(basket => {
        const option = document.createElement('option');
        option.value = basket.id;
        option.textContent = basket.name;
        basketSelect.appendChild(option);
      });

      // Listen for user's selection and send selected basket and remaining baskets along with inserted ID to final API endpoint
      const thirdApiUrl = 'http://100061.pythonanywhere.com/basket/';

      const submitButton = document.querySelector('#submitButton');

      submitButton.addEventListener('click', () => {
        const selectedBasketId = basketSelect.value;
        const remainingBaskets = data.baskets.filter(basket => basket.id !== selectedBasketId);

        const finalData = {
          insertedId: data.insertedId,
          selectedBasketId,
          remainingBaskets
        };

        fetch(thirdApiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(finalData)
        })
        .then(response => response.json())
        .then(data => {
          // handle final API response here
          console.log(data);
        })
        .catch(error => {
          console.error(error);
        });
      });
    })
    .catch(error => {
      console.error(error);
    });
  })
  .catch(error => {
    console.error(error);
  });
});

</script>      